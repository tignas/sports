{% set base_headers = ['name', 'pos', 'team'] %}
{% set stat_items = ['gp', 'min', 'fgm', 'fga', 'fg%', '3ptm', '3pta', '3pt%', 
                     'ftm', 'fta', 'ft%', 'oreb', 'dreb', 'reb', 'ast', 
                     'stl', 'blk', 'tos', 'pf', '+/-', 'pts'] %}

{% for stat_type in stat_types %}
<table class="player_table" id="per_{{stat_type}}">
    <tr>
    {% for base_header in base_headers %}
        <th>{{base_header}}</th>
    {% endfor %}
    {% for stat_item in stat_items %}
        <th>{{stat_item}}</th>
    {% endfor %}
    </tr>
</thead>
<tbody>
    {% for player in players %}
    {% set stat = player._asdict() %}
    <tr>
        <td><a href='{{stat['Player'].url()}}'>{{stat['Player'].person}}</a></td>
        <td>{{stat['Player'].position_string()}}</td>
        <td><a href='{{stat['Team'].url()}}'>{{stat['Team'].abbr}}</a></td>
        {% for stat_item in stat_items %}
        {% if stat_item in ['fg%', '3pt%', 'ft%'] %}
            {% if stat[stat_item[0:-1]+'a'] == 0 %}
                {% set pct = 0 %}
            {% else %}
                {% set pct = stat[stat_item[0:-1]+'m']/stat[stat_item[0:-1]+'a']*100 %}
            {% endif %}
            <td>{{pct|round(2)}}</td>
        {% else %}
            {% if stat[stat_item] %}
                {% if stat_type in ['game', '36'] and stat_item == 'gp' %}
                    {% set stat_calc = stat[stat_item] %}
                {% elif stat_type == '36' %}
                    {% if stat['min'] == 0 %}
                        {% set stat_calc = 0 %}
                    {% elif stat_item == 'min' %}
                        {% set stat_calc = stat[stat_item]/stat['gp'] %}
                    {% else %}
                        {% set stat_calc = stat[stat_item]*36/stat['min'] %}
                    {% endif %}
                {% elif stat_type == 'game' %}
                    {% set stat_calc = stat[stat_item]/stat['gp'] %}
                {% else %}
                    {% set stat_calc = stat[stat_item] %}
                {% endif %}
                <td>{{stat_calc|float|round(1)}}</td>
            {% else %}
                <td>0</td>
            {% endif %}
        {% endif %}
        {% endfor %}
    </tr>
    {% endfor %}    
</tbody>
</table>
{% endfor %}
